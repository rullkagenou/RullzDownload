<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RullkageDg.com - Downloader</title>
  <style>
    :root{
      --bg:#0f172a;
      --card:#1e293b;
      --accent:#00bfff;
      --accent-2:#4c1d95;
      --muted:#cbd5e1;
      --green:#25D366;
      --btn:#00bfff;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: var(--bg);
      color: white;
    }
    .sidebar {
      position: fixed; top:0; left:0; width:220px; height:100vh;
      background: var(--card); padding:20px; z-index:50;
      box-shadow: 0 8px 24px rgba(2,6,23,0.6);
    }
    .logo { font-weight:800; color:var(--accent); font-size:18px; margin-bottom:12px; }
    .submenu a {
      display:block; color:var(--muted); text-decoration:none;
      padding:8px; border-radius:6px; margin-bottom:4px;
    }
    .submenu a:hover { background: var(--accent); color:#fff; }
    .container { margin-left:240px; padding:28px; max-width:980px; }
    .card {
      background: var(--card); padding:18px; border-radius:12px; margin-top:18px;
    }
    input[type="text"] {
      width:100%; padding:12px 14px; border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      background:transparent; color:var(--muted);
    }
    .btn-primary {
      background: var(--btn); color:white; padding:12px 16px;
      border-radius:12px; font-weight:700; border:none; cursor:pointer;
    }
    .download-btn {
      display:block; width:100%; text-align:center;
      background: linear-gradient(90deg,#00bfff,#0066cc);
      color:white; padding:14px; border-radius:12px;
      margin-top:12px; font-size:16px; font-weight:700;
      text-decoration:none;
    }
    .download-btn--alt { background: linear-gradient(90deg,#25D366,#1aa34a); }
    video, img, audio { width:100%; border-radius:10px; display:block; background:#000; }
    .muted { color: var(--muted); font-size:13px; }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="logo">RullkageDg.com</div>
    <div class="submenu">
      <a href="#">Home</a>
      <a href="#">Cara Pakai</a>
      <a href="#">About</a>
    </div>
  </aside>

  <main class="container">
    <h1 style="color:var(--accent)">Downloader AIO</h1>
    <div class="card">
      <input id="urlInput" type="text" placeholder="Tempel link di sini...">
      <div style="margin-top:10px;">
        <button class="btn-primary" onclick="getMedia()">Ambil Media</button>
      </div>
      <div id="result" style="margin-top:20px;"></div>
    </div>
  </main>

  <script>
    async function getMedia(){
      const url = document.getElementById('urlInput').value.trim();
      const result = document.getElementById('result');
      if(!url){ alert('Masukkan link dulu!'); return; }
      result.innerHTML = '<div class="muted">Mengambil data...</div>';

      try{
        const r = await fetch(`https://api.finix-id.my.id/download/aio?url=${encodeURIComponent(url)}`);
        const data = await r.json();
        if(!data || !data.status || !data.result){
          result.innerHTML = '<div class="muted">Gagal ambil data.</div>'; return;
        }
        const res = data.result, medias = res.medias||[];
        let html = '';

        // VIDEO
        const videos = medias.filter(m=>m.type==='video');
        if(videos.length){
          const best = videos.find(v=>/no_watermark/i.test(v.quality)) || videos[0];
          html += `<h4 style="color:var(--accent)">Video</h4>
            <video controls><source src="${best.url}" type="video/mp4"></video>
            <a class="download-btn download-btn--alt" href="/api/download?url=${encodeURIComponent(best.url)}&filename=video.mp4">⬇ Download Video</a>`;
        }

        // IMAGE
        const images = medias.filter(m=>m.type==='image');
        if(images.length){
          html += `<h4 style="color:var(--accent);margin-top:14px;">Gambar</h4>`;
          images.forEach((img,i)=>{
            html += `<img src="${img.url}" alt="img${i+1}" style="margin-top:8px;">
            <a class="download-btn" href="/api/download?url=${encodeURIComponent(img.url)}&filename=image_${i+1}.jpg">⬇ Download Gambar</a>`;
          });
        }

        // AUDIO
        const audios = medias.filter(m=>m.type==='audio' || ['mp3','m4a'].includes(m.extension));
        if(audios.length){
          html += `<h4 style="color:var(--accent);margin-top:14px;">Audio</h4>`;
          audios.forEach((a,i)=>{
            html += `<audio controls style="margin-top:8px;">
              <source src="${a.url}" type="audio/${a.extension||'mpeg'}"></audio>
              <a class="download-btn" href="/api/download?url=${encodeURIComponent(a.url)}&filename=audio_${i+1}.${a.extension||'mp3'}">⬇ Download Audio</a>`;
          });
        }

        if(!html) html='<div class="muted">Media tidak ditemukan.</div>';
        result.innerHTML=html;

      }catch(err){
        console.error(err);
        result.innerHTML='<div class="muted">Error ambil data.</div>';
      }
    }
  </script>
</body>
</html>